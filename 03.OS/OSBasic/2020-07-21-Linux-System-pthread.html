<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>零、准备工作 | HACV</title>
    <meta name="description" content="Personal Blog Website">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.8eb0d87d.css" as="style"><link rel="preload" href="/assets/js/app.7ced881c.js" as="script"><link rel="preload" href="/assets/js/54.17f28cb1.js" as="script"><link rel="prefetch" href="/assets/js/10.8bbeb718.js"><link rel="prefetch" href="/assets/js/100.8bb2c016.js"><link rel="prefetch" href="/assets/js/101.2179dc24.js"><link rel="prefetch" href="/assets/js/102.193e8b92.js"><link rel="prefetch" href="/assets/js/103.97134d8c.js"><link rel="prefetch" href="/assets/js/104.0719dce6.js"><link rel="prefetch" href="/assets/js/105.8f6960f8.js"><link rel="prefetch" href="/assets/js/106.864439b5.js"><link rel="prefetch" href="/assets/js/107.0ef90bf1.js"><link rel="prefetch" href="/assets/js/108.94f4d0d2.js"><link rel="prefetch" href="/assets/js/109.dff14bbf.js"><link rel="prefetch" href="/assets/js/11.390e9c09.js"><link rel="prefetch" href="/assets/js/110.e1afc419.js"><link rel="prefetch" href="/assets/js/111.ec92886d.js"><link rel="prefetch" href="/assets/js/112.708b6410.js"><link rel="prefetch" href="/assets/js/113.36c7b141.js"><link rel="prefetch" href="/assets/js/114.60bf5424.js"><link rel="prefetch" href="/assets/js/115.b016c05b.js"><link rel="prefetch" href="/assets/js/116.19d3704f.js"><link rel="prefetch" href="/assets/js/117.1e70075a.js"><link rel="prefetch" href="/assets/js/118.0479fb97.js"><link rel="prefetch" href="/assets/js/119.a309ee1f.js"><link rel="prefetch" href="/assets/js/12.47752e11.js"><link rel="prefetch" href="/assets/js/120.e0d4e2e4.js"><link rel="prefetch" href="/assets/js/121.1f56742b.js"><link rel="prefetch" href="/assets/js/122.04f218a9.js"><link rel="prefetch" href="/assets/js/123.1b975e64.js"><link rel="prefetch" href="/assets/js/124.89fbc462.js"><link rel="prefetch" href="/assets/js/125.248be577.js"><link rel="prefetch" href="/assets/js/126.5ca03798.js"><link rel="prefetch" href="/assets/js/127.1e22e83e.js"><link rel="prefetch" href="/assets/js/128.1436609d.js"><link rel="prefetch" href="/assets/js/129.20bdc2ba.js"><link rel="prefetch" href="/assets/js/13.9ab56618.js"><link rel="prefetch" href="/assets/js/130.a1df8a19.js"><link rel="prefetch" href="/assets/js/131.41b92c13.js"><link rel="prefetch" href="/assets/js/132.55535879.js"><link rel="prefetch" href="/assets/js/133.20ba13c7.js"><link rel="prefetch" href="/assets/js/134.4d5f4f94.js"><link rel="prefetch" href="/assets/js/135.20b0b603.js"><link rel="prefetch" href="/assets/js/136.99cc4ebf.js"><link rel="prefetch" href="/assets/js/137.3204c7e5.js"><link rel="prefetch" href="/assets/js/138.912d80d6.js"><link rel="prefetch" href="/assets/js/139.f6bca21c.js"><link rel="prefetch" href="/assets/js/14.62a5eff5.js"><link rel="prefetch" href="/assets/js/140.ffc82a85.js"><link rel="prefetch" href="/assets/js/141.895c7359.js"><link rel="prefetch" href="/assets/js/142.2378879c.js"><link rel="prefetch" href="/assets/js/143.c7c5bea4.js"><link rel="prefetch" href="/assets/js/144.0206347f.js"><link rel="prefetch" href="/assets/js/145.e6cd79b8.js"><link rel="prefetch" href="/assets/js/146.286874a1.js"><link rel="prefetch" href="/assets/js/147.0251fceb.js"><link rel="prefetch" href="/assets/js/148.6ed312fb.js"><link rel="prefetch" href="/assets/js/149.9ada5e93.js"><link rel="prefetch" href="/assets/js/15.7d2d48ae.js"><link rel="prefetch" href="/assets/js/16.8786bc8f.js"><link rel="prefetch" href="/assets/js/17.5312e725.js"><link rel="prefetch" href="/assets/js/18.0627885a.js"><link rel="prefetch" href="/assets/js/19.110980f3.js"><link rel="prefetch" href="/assets/js/2.858e80da.js"><link rel="prefetch" href="/assets/js/20.fada5d94.js"><link rel="prefetch" href="/assets/js/21.fef9831b.js"><link rel="prefetch" href="/assets/js/22.312e3a38.js"><link rel="prefetch" href="/assets/js/23.33f46c53.js"><link rel="prefetch" href="/assets/js/24.00a66de9.js"><link rel="prefetch" href="/assets/js/25.2f188985.js"><link rel="prefetch" href="/assets/js/26.68654ac5.js"><link rel="prefetch" href="/assets/js/27.6cab9932.js"><link rel="prefetch" href="/assets/js/28.754b96e8.js"><link rel="prefetch" href="/assets/js/29.d1ed41d5.js"><link rel="prefetch" href="/assets/js/3.53ecd128.js"><link rel="prefetch" href="/assets/js/30.056a1a2e.js"><link rel="prefetch" href="/assets/js/31.274d0f03.js"><link rel="prefetch" href="/assets/js/32.d1ec2cf6.js"><link rel="prefetch" href="/assets/js/33.80d80fee.js"><link rel="prefetch" href="/assets/js/34.e1287e62.js"><link rel="prefetch" href="/assets/js/35.047e41da.js"><link rel="prefetch" href="/assets/js/36.dc87e012.js"><link rel="prefetch" href="/assets/js/37.9be237bc.js"><link rel="prefetch" href="/assets/js/38.a2ed656e.js"><link rel="prefetch" href="/assets/js/39.c6893003.js"><link rel="prefetch" href="/assets/js/4.ba718c7b.js"><link rel="prefetch" href="/assets/js/40.7fc8dd0c.js"><link rel="prefetch" href="/assets/js/41.95871ed4.js"><link rel="prefetch" href="/assets/js/42.2252d8af.js"><link rel="prefetch" href="/assets/js/43.081ffb45.js"><link rel="prefetch" href="/assets/js/44.a6b3c3cf.js"><link rel="prefetch" href="/assets/js/45.a3ce1167.js"><link rel="prefetch" href="/assets/js/46.befd8516.js"><link rel="prefetch" href="/assets/js/47.f34f9cc4.js"><link rel="prefetch" href="/assets/js/48.62761611.js"><link rel="prefetch" href="/assets/js/49.50244f3f.js"><link rel="prefetch" href="/assets/js/5.4ebbb385.js"><link rel="prefetch" href="/assets/js/50.c10bb0e6.js"><link rel="prefetch" href="/assets/js/51.67c6a7c3.js"><link rel="prefetch" href="/assets/js/52.66f9e181.js"><link rel="prefetch" href="/assets/js/53.c062257d.js"><link rel="prefetch" href="/assets/js/55.dc23a12c.js"><link rel="prefetch" href="/assets/js/56.33ba6493.js"><link rel="prefetch" href="/assets/js/57.caa5f93a.js"><link rel="prefetch" href="/assets/js/58.81155e36.js"><link rel="prefetch" href="/assets/js/59.e08a57ff.js"><link rel="prefetch" href="/assets/js/6.0bff5906.js"><link rel="prefetch" href="/assets/js/60.fb48eb65.js"><link rel="prefetch" href="/assets/js/61.b96b4857.js"><link rel="prefetch" href="/assets/js/62.95df7c0f.js"><link rel="prefetch" href="/assets/js/63.c0e8f45a.js"><link rel="prefetch" href="/assets/js/64.123f6205.js"><link rel="prefetch" href="/assets/js/65.c81e7694.js"><link rel="prefetch" href="/assets/js/66.5b421a1d.js"><link rel="prefetch" href="/assets/js/67.b4cf9b85.js"><link rel="prefetch" href="/assets/js/68.ca74c091.js"><link rel="prefetch" href="/assets/js/69.ddce66b6.js"><link rel="prefetch" href="/assets/js/7.38fc841b.js"><link rel="prefetch" href="/assets/js/70.a1a070e2.js"><link rel="prefetch" href="/assets/js/71.2fa4cae7.js"><link rel="prefetch" href="/assets/js/72.36ba10c5.js"><link rel="prefetch" href="/assets/js/73.0d7cd69e.js"><link rel="prefetch" href="/assets/js/74.b11e66cc.js"><link rel="prefetch" href="/assets/js/75.0d6e6c25.js"><link rel="prefetch" href="/assets/js/76.568ff8ad.js"><link rel="prefetch" href="/assets/js/77.384486fa.js"><link rel="prefetch" href="/assets/js/78.28543a49.js"><link rel="prefetch" href="/assets/js/79.c663b96a.js"><link rel="prefetch" href="/assets/js/8.f1e98a93.js"><link rel="prefetch" href="/assets/js/80.c29ab1c1.js"><link rel="prefetch" href="/assets/js/81.a691899e.js"><link rel="prefetch" href="/assets/js/82.0abbd819.js"><link rel="prefetch" href="/assets/js/83.0fc366f1.js"><link rel="prefetch" href="/assets/js/84.e0ed2811.js"><link rel="prefetch" href="/assets/js/85.f80c5a57.js"><link rel="prefetch" href="/assets/js/86.1b584c20.js"><link rel="prefetch" href="/assets/js/87.b510718a.js"><link rel="prefetch" href="/assets/js/88.a4ea3ca8.js"><link rel="prefetch" href="/assets/js/89.f94475e4.js"><link rel="prefetch" href="/assets/js/9.76534e6a.js"><link rel="prefetch" href="/assets/js/90.ebb71b6d.js"><link rel="prefetch" href="/assets/js/91.a9536afd.js"><link rel="prefetch" href="/assets/js/92.efca5e7b.js"><link rel="prefetch" href="/assets/js/93.6d8e987d.js"><link rel="prefetch" href="/assets/js/94.9ce224b6.js"><link rel="prefetch" href="/assets/js/95.5c5b086a.js"><link rel="prefetch" href="/assets/js/96.78136865.js"><link rel="prefetch" href="/assets/js/97.73892c20.js"><link rel="prefetch" href="/assets/js/98.1bde759b.js"><link rel="prefetch" href="/assets/js/99.0e1f1ce6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8eb0d87d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HACV</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/02.DataStructureAndAlgorithm/" class="nav-link">🐾数据结构和算法</a></div><div class="nav-item"><a href="/03.OS/" class="nav-link router-link-active">💻操作系统</a></div><div class="nav-item"><a href="/04.Net/" class="nav-link">☁️网络</a></div><div class="nav-item"><a href="/05.SE/" class="nav-link">☕️软件工程</a></div><div class="nav-item"><a href="/06.SQL/" class="nav-link">💾数据库</a></div><div class="nav-item"><a href="/07.InternalSkill/" class="nav-link">🐉计算机内功</a></div><div class="nav-item"><a href="/08.Tools/" class="nav-link">🔧Tools</a></div><div class="nav-item"><a href="/09.Language/" class="nav-link">⚛️C/C++</a></div><div class="nav-item"><a href="https://github.com/HACV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/02.DataStructureAndAlgorithm/" class="nav-link">🐾数据结构和算法</a></div><div class="nav-item"><a href="/03.OS/" class="nav-link router-link-active">💻操作系统</a></div><div class="nav-item"><a href="/04.Net/" class="nav-link">☁️网络</a></div><div class="nav-item"><a href="/05.SE/" class="nav-link">☕️软件工程</a></div><div class="nav-item"><a href="/06.SQL/" class="nav-link">💾数据库</a></div><div class="nav-item"><a href="/07.InternalSkill/" class="nav-link">🐉计算机内功</a></div><div class="nav-item"><a href="/08.Tools/" class="nav-link">🔧Tools</a></div><div class="nav-item"><a href="/09.Language/" class="nav-link">⚛️C/C++</a></div><div class="nav-item"><a href="https://github.com/HACV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>零、准备工作</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#cover-falsepassword" class="sidebar-link">cover: false
password:</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#零、准备工作" class="sidebar-link">零、准备工作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_1）非红帽的，比如乌班图" class="sidebar-link">1）非红帽的，比如乌班图</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_2）红帽系列，centos" class="sidebar-link">2）红帽系列，CentOS</a></li></ul></li><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#一、线程基础" class="sidebar-link">一、线程基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#二、linux下线程的实现原理" class="sidebar-link">二、Linux下线程的实现原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_1）三级页表" class="sidebar-link">1）三级页表</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_2）线程优点和缺点" class="sidebar-link">2）线程优点和缺点</a></li></ul></li><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#三、线程控制原语" class="sidebar-link">三、线程控制原语</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_1）pthread-self函数（获得线程id）" class="sidebar-link">1）pthread_self函数（获得线程ID）</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_2）pthread-create函数（创建线程）" class="sidebar-link">2）pthread_create函数（创建线程）</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_3）pthread-exit函数（退出线程）" class="sidebar-link">3）pthread_exit函数（退出线程）</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_4）pthread-join函数（用于，线程回收）" class="sidebar-link">4）pthread_join函数（用于，线程回收）</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_5）pthread-detach函数（线程分离）" class="sidebar-link">5）pthread_detach函数（线程分离）</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_6）pthread-cancel函数（杀死线程）" class="sidebar-link">6）pthread_cancel函数（杀死线程）</a></li><li class="sidebar-sub-header"><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#_7）pthread-equal函数（判断进程id相等）" class="sidebar-link">7）pthread_equal函数（判断进程ID相等）</a></li></ul></li><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#控制原语对比" class="sidebar-link">控制原语对比</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#四、线程属性" class="sidebar-link">四、线程属性</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/03.OS/OSBasic/2020-07-21-Linux-System-pthread.html#五、线程库版本（nptl实现机制-posix-，native-posix-thread-library）" class="sidebar-link">五、线程库版本（NPTL实现机制(POSIX)，Native POSIX Thread Library）</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><hr> <p>title:  Linux系统——线程
date: 2020-07-21 09:00:00
categories:</p> <ul><li>操作系统
tags:</li> <li>Linux</li></ul> <p>img: /photos/2020.6.03_15/2020_06_15_cover.jpg
top: false
summary: 线程
mathjax: true</p> <h2 id="cover-falsepassword"><a href="#cover-falsepassword" class="header-anchor">#</a> cover: false
password:</h2> <h2 id="零、准备工作"><a href="#零、准备工作" class="header-anchor">#</a> 零、准备工作</h2> <p>安装pthread的man pages</p> <h3 id="_1）非红帽的，比如乌班图"><a href="#_1）非红帽的，比如乌班图" class="header-anchor">#</a> 1）非红帽的，比如乌班图</h3> <p>命令：<code>sudo apt-get install manpages-posix-dev</code></p> <h3 id="_2）红帽系列，centos"><a href="#_2）红帽系列，centos" class="header-anchor">#</a> 2）红帽系列，CentOS</h3> <p>安装pthread的man pages：<code>yum -y install man-pages</code></p> <p>安装完成，使用<code>man -k pthread</code>如能看到线程函数列表则表明安装成功。</p> <p>系统要是不带，比如，我的阿里云CentOS</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>[省略]# man -k pthread
pthread: nothing appropriate.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>安装</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>[省略]# yum -y install man-pages
CentOS-8 - AppStream                                                                                                              627 kB/s | 4.3 kB     00:00    
CentOS-8 - Base                                                                                                                   608 kB/s | 3.9 kB     00:00    
CentOS-8 - Extras                                                                                                                 257 kB/s | 1.5 kB     00:00    
Extra Packages for Enterprise Linux 8 - x86_64                                                                                    806 kB/s | 4.7 kB     00:00    
Package man-pages-4.15-6.el8.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>但是，<code>man -k pthread</code>还是没有
如何解决？？</p> <p>我进行yum源更新</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>yum update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后，就可以了。</p> <p>效果如下：</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>[省略~]# man -k pthread
pthread.h (0p)       - threads
pthread_atfork (3)   - register fork handlers
pthread_atfork (3p)  - register fork handlers
pthread_attr_destroy (3) - initialize and destroy thread attributes object
pthread_attr_destroy (3p) - destroy and initialize the thread attributes object
pthread_attr_getaffinity_np (3) - set/get CPU affinity attribute in thread 
省略
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="本章概述"><a href="#本章概述" class="header-anchor">#</a> 本章概述</h1> <blockquote><ul><li>1.线程概念
线程与进程关系。
线程之间共享、非共享
优缺点</li> <li>2.线程控制原语（对线程进行控制的时候，所要使用到的函数,几乎能和线程控制原语能一一对应起来）
pthread_self
create
exit
join
对比记忆
|进程|线程|
|---|---|
|fork		|pthead_create|
|exit(10)	|pthead_exit(void *);|
|wait(int *)	|pthread_join（， void **）   阻塞     分离 22 ； cancel -1|
|kill()		|pthread_cancel();	取消点(检查点)：系统调用|
man 7 pthreads
pthread_testcancel(); 系统调用
getpid()	pthread_self();
pthread_detach();  分离。 --自动清理pcb。</li> <li><ol start="3"><li>线程属性（扩展知识，特殊应用）
修改线程属性的方法</li></ol></li> <li><ol start="4"><li>注意的事项</li></ol></li></ul></blockquote> <p>要求，能够完成，线程和进程控制原语进行对比记忆！！！！</p> <h2 id="一、线程基础"><a href="#一、线程基础" class="header-anchor">#</a> 一、线程基础</h2> <p>什么是线程？
Linux下的线程实现和Windows下的实现是完全不一样的原理。
（详见，我的另一篇博客）</p> <blockquote><ul><li>Linux下，线程是依托于进程来实现的！
类Unix系统中，早期是没有“线程”概念的，80年代才引入，借助进程机制实现出了线程的概念。因此在这类系统中，进程和线程关系密切。</li> <li>出来是因为，其他操作系统中提出了线程这个概念，Unix为了不落后。</li></ul></blockquote> <p>其实，类Unix里面，进程设计这种理念实际上比较完善了。
没有很大的缺点。（所以，硬生生，把进程那啥，变成线程。。。变化过来的）
而进程在Windows操作系统下，几乎没法用。系统能力不是一般的低。
因此，Windows下线程是非常常见的，进程反而很少去提到。</p> <p>Linux下，用线程和进程差别不是特别大（但是有差别），看个人习惯和爱好</p> <p>Linux下线程：LWP：light weight process 轻量级的进程，本质仍是进程(在Linux环境下)</p> <p>Linux下的进程和线程对比</p> <table><thead><tr><th>进程</th> <th>线程</th></tr></thead> <tbody><tr><td>（独居）独立地址空间，拥有PCB</td> <td>（一块住，合租）也有PCB，但没有独立的地址空间(共享)</td></tr> <tr><td>最小<strong>分配资源</strong>单位，可看成是只有一个线程的进程</td> <td>最小的<strong>执行</strong>单位</td></tr></tbody></table> <blockquote><ul><li>Q:为什么多线程下载更快？？
A：由于线程是最小的<strong>执行</strong>单位，所以，线程多的，相同时间内，能够被分到CPU的概率大一些，执行起来会快一些。因此多线程能够提高程序的执行效率。</li></ul></blockquote> <h2 id="二、linux下线程的实现原理"><a href="#二、linux下线程的实现原理" class="header-anchor">#</a> 二、Linux下线程的实现原理</h2> <blockquote><ul><li>1）创建线程使用的底层函数和进程一样，都是clone
就是说，pthead_create和fork底层都是调用clone函数。</li> <li>2）从内核（操作系统来看）里看进程和线程是一样的,都有各自不同的PCB，但是<strong>PCB中指向内存资源的三级页表是相同的</strong></li></ul> <blockquote><ul><li>因为操作系统区分进程和线程，以PCB作为区分依据，PCB叫做进程控制块/进程描述符，，正是因为这个PCB的这个，因此把PCB分配给一个线程，他就伪装成一个进程，因此CPU在分配时间片的时候，他才会把一个线程也分配一个自己的时间片,加快执行效率。（根本原因：因为，内部在实现的时候，有一个关于内存映射的这样一个问题）</li></ul></blockquote></blockquote> <h3 id="_1）三级页表"><a href="#_1）三级页表" class="header-anchor">#</a> 1）三级页表</h3> <p>什么叫三级页表?</p> <img src="https://gitee.com/HACV/images_bed/raw/master/MainBlog/2020/2020_07/07_21/01.png"> <p>有的指针指向一个空间，我们叫页表。
如图，一个个目录项都是一个指针。
如上图，上面采用的三级映射的方法，4个东西，整个称之为3级页表。
三级映射和我们之前讲过的
虚拟内存和物理内存映射是什么关系？？
我们上面的，三级页表实际上就是在描述，MMU怎么样帮你把虚拟地址，映射到物理地址！！
上面的是简略的图，实际上的不能直接从用户空间对应过去。
MMU有个映射表，显然这个会和我们的三级页表进行对应，其实，映射表是保存在内核空间的。</p> <p><strong>注意图片中，新建的线程，虽然PCB是和前面的进程独立的，但是那个指针还是一样的（注意）</strong></p> <p>线程与线程之间，肯定整个地址空间不会完全相同，最起码要保证运行指令不一样。（不然，你复制有意义吗？）</p> <blockquote><ul><li>线程可看做寄存器和栈的集合（栈，线程在执行过程中，我们执行的主要依据是：函数调用，因为线程1和2内部的函数是不一样的）
<font size="5" style="background:yellow;"><strong>注意，强调了栈</strong></font></li></ul></blockquote> <p>实际上分配空间，就是两个指针，esp和ebp的移动。
原先是重合，后面慢慢拉开，形成栈帧（帧，一张张，我们知道，每一个函数有属于自己运行的栈帧空间）</p> <p>（注意：栈帧里面放局部变量和<strong>临时值</strong>（比如，某函数被调用，那他要<strong>保留，原先的ebp和esp</strong>，这样这个函数被调用完之后，才能返回去））</p> <p>如上分析：
每一个线程在调用的时候，都有自己的函数调用。那么<strong>每一个线程的stack空间（用户空间中的栈），不能一样</strong>。不然，线程与线程之间，无法区分。</p> <p>上面的内核区，其实还有内核栈，它的作用，主要是用来保存寄存器的值。
什么时候需要保存？？<strong>进程在要切换</strong>的时候，因为CPU要把时间轮片分给不同的进程。
现在变成线程的概念，现在CPU要把这个分配给线程运行，那么线程需不需要保存寄存器的值？显然需要，所以，显然线程需要有属于自己的内核栈空间。
（所以，能理解寄存器和栈那些了）</p> <p>Linux下CPU划分时间仑片，是依据什么？
lwp号（其实叫，轻量级线程，但是我们也可以叫，线程号，，）</p> <p>Linux下命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ps</span> -Lf <span class="token number">3500</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>比如，这样，能知道3500这个进程下有哪些线程？</p> <p>比如，Firefox里面采用的<strong>线程池</strong>机制，同时开了好多个。
所以，可能我们只打开了几个页面，却发现有好多个线程。</p> <p><font style="background:yellow;">lwp是线程号，但是不是线程id，注意</font></p> <blockquote><ul><li><strong>线程号</strong>的作用：CPU分配时间仑片的作用</li> <li><strong>线程id</strong>的作用：是进程内部区分线程的!!!!</li></ul></blockquote> <p>同一个进程中的线程，他们的PCB虽然是不一样的，但是其中的三级页表却是相同的。</p> <h3 id="_2）线程优点和缺点"><a href="#_2）线程优点和缺点" class="header-anchor">#</a> 2）线程优点和缺点</h3> <blockquote><ul><li>线程<strong>共享</strong>资源
1.文件描述符表
2.每种信号的处理方式（由于，线程和信号都很麻烦，编程的时候，能够减少他们合体就尽量避免——</li></ul> <blockquote><ul><li>信号和进程是早期就有的，但信号复杂，线程是后期才有的。
3.当前工作目录（工作目录是根据进程定的）
4.用户ID和组ID
5.<strong>内存地址空间 (.text/.data/.bss/heap/共享库)</strong>，0-3G就把那个stack给排除了。</li></ul></blockquote> <ul><li>线程<strong>非共享</strong>资源
1.线程id
2.处理器现场（即，寄存器的值）和栈指针(内核栈)
3.独立的栈空间(用户空间栈)
4.<strong>errno变量</strong>（这个变量，是个全局变量，是放在.data段，但是，他很特殊，每个线程独享。注意！！）
5.信号屏蔽字（毕竟，线程概念是后面来的）
6.<strong>调度优先级</strong></li></ul></blockquote> <p>线程优、缺点
优点：
1.提高程序并发性
2.开销小（开10个线程比开10个进程小）
3.数据通信、共享数据方便（如前分析，比如，我们进程之间通信用IPC，现在我们线程都不需要这个了，比如全局变量，只见拿过来用）
缺点：
1.库函数，不稳定（线程里面，所有的函数都是库函数，所以说，对于第3方库函数而言，相较于进程而言，我们在进程当中，使用的函数，绝大多数都是系统调用，稳定性高一些，，但是线程的库函数的稳定性却没那么高）
2.调试、编写困难、gdb不支持（别的不说，gdb你在线程里面就别用了，用也用不了，因为gdb出现的时候，线程概念还没出现，，，，）（有第3方开发工具，就用它调试，没有就靠自己手工切，滑稽，其实可以加输出，其实高手调试的时候，都是直接加printf来，一般不用调试工具，这个调试方法，永远有效）
3.对信号支持不好（毕竟，线程概念出现比较晚）</p> <p>优点相对突出，缺点均不是硬伤。Linux下由于实现方法导致进程、线程差别不是很大。</p> <p>所以，从熟识度来说，可能用进程编程的人多一些
但是，从程序角度，用线程。</p> <h2 id="三、线程控制原语"><a href="#三、线程控制原语" class="header-anchor">#</a> 三、线程控制原语</h2> <h3 id="_1）pthread-self函数（获得线程id）"><a href="#_1）pthread-self函数（获得线程id）" class="header-anchor">#</a> 1）pthread_self函数（获得线程ID）</h3> <p>获取<strong>线程ID</strong>
对应进程中 getpid() 函数</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>pthread_t pthread_self(void);	返回值：成功：0；	失败：无！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>线程ID：pthread_t类型，本质：在Linux下为无符号整数(%lu)，其他系统中可能是结构体实现
线程ID是进程内部，识别标志。(两个进程间，线程ID允许相同)
注意：不应使用全局变量 pthread_t tid，在子线程中通过pthread_create传出参数来获取线程ID，而应使用pthread_self。</p> <p>我们安装的man page起作用了</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">man</span> pthread_self
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-txt line-numbers-mode"><pre class="language-text"><code>PTHREAD_SELF(3)                       Linux Programmer's Manual                      PTHREAD_SELF(3)
NAME
       pthread_self - obtain ID of the calling thread
SYNOPSIS
       #include &lt;pthread.h&gt;
       pthread_t pthread_self(void);
       Compile and link with -pthread.
       //这句话告诉，gcc编译，链接使用-pthread才能编译通过
       //原因：从某种角度来讲，我们的线程库不是标准库，不是大家经常使用的标准C库了。
       //gcc编译的时候却是在给我们链接标准C库。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2）pthread-create函数（创建线程）"><a href="#_2）pthread-create函数（创建线程）" class="header-anchor">#</a> 2）pthread_create函数（创建线程）</h3> <p>创建一个新线程。
其作用，对应进程中fork() 函数。</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>	int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg);
	返回值：成功：0；	失败：错误号	-----Linux环境下，所有线程特点，失败均直接返回错误号。（这是和进程不同的地方）
    可以借助下面的
    strerror函数很简单，参数要接受一个错误号，帮你把这个错误号，转换为错误字符串描述。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数：
pthread_t：当前Linux中可理解为：typedef  unsigned long int  pthread_t;
参数1：传出参数，保存系统为我们分配好的线程ID
参数2：通常传NULL，表示使用线程默认属性。若想使用具体属性也可以修改该参数。（一般使用，NULL表示线程的默认属性）
参数3：函数指针，指向线程主函数(线程体)，该函数运行结束，则线程结束。
参数4：线程主函数执行期间所使用的参数。</p> <p>我们写一个函数测试一下</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h&gt;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    <span class="token keyword">int</span> var<span class="token punctuation">;</span>
    <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">exit_t</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">thrd_func</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">exit_t</span> <span class="token operator">*</span>retvar <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">exit_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>arg<span class="token punctuation">;</span>

    retvar<span class="token operator">-&gt;</span>ch <span class="token operator">=</span> <span class="token string">'m'</span><span class="token punctuation">;</span>
    retvar<span class="token operator">-&gt;</span>var <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>retvar<span class="token operator">-&gt;</span>str<span class="token punctuation">,</span> <span class="token string">&quot;my thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>retvar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span>
    <span class="token keyword">int</span> ret<span class="token punctuation">;</span>
    <span class="token class-name">exit_t</span> <span class="token operator">*</span>retval <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">exit_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ret <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thrd_func<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;pthread_create error:%s\n&quot;</span><span class="token punctuation">,</span> <span class="token function">strerror</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ch = %c, var = %d, str = %s\n&quot;</span><span class="token punctuation">,</span> retval<span class="token operator">-&gt;</span>ch<span class="token punctuation">,</span> retval<span class="token operator">-&gt;</span>var<span class="token punctuation">,</span> retval<span class="token operator">-&gt;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>注意链接的时候记得加上</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>[略~]# gcc -pthread te.c
[略 ~]# ls
a.out  solution.cpp  te.c  test.c
[略 ~]# ./a.out
ch = m, var = 200, str = my thread
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>线程之间共享全局变量
进程之间全局变量是不共享的，所以才有的IPC。</p> <h3 id="_3）pthread-exit函数（退出线程）"><a href="#_3）pthread-exit函数（退出线程）" class="header-anchor">#</a> 3）pthread_exit函数（退出线程）</h3> <p>将单个线程退出</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>void pthread_exit(void *retval);	参数：retval表示线程退出状态，通常传NULL
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4）pthread-join函数（用于，线程回收）"><a href="#_4）pthread-join函数（用于，线程回收）" class="header-anchor">#</a> 4）pthread_join函数（用于，线程回收）</h3> <p>阻塞等待线程退出，获取线程退出状态
其作用，对应进程中 waitpid() 函数。</p> <h3 id="_5）pthread-detach函数（线程分离）"><a href="#_5）pthread-detach函数（线程分离）" class="header-anchor">#</a> 5）pthread_detach函数（线程分离）</h3> <p>这个函数在进程当中没有对应的
实现<strong>线程分离</strong></p> <pre><code>int pthread_detach(pthread_t thread);	成功：0；失败：错误号
线程分离状态：指定该状态，线程主动与主控线程断开关系。线程结束后，其退出状态不由其他线程获取，而直接自己自动释放。
&lt;font style=&quot;background: yellow&quot; size=5&gt;网络、多线程服务器常用。(很重要，因为状态分离后就不会产生僵尸进程了）&lt;/font&gt;
</code></pre> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>从状态上实现了分离，好处如下：
进程若有该机制，将不会产生僵尸进程。僵尸进程的产生主要由于进程死后，大部分资源被释放，一点残留资源仍存于系统中，导致内核认为该进程仍存在。
因此在，网络、多线程服务器常用。
也可使用 pthread_create函数参2(线程属性)来设置线程分离。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>记得有书上说，虽说理论上，线程创建好之后，就和父进程在等同的地位上抢夺CPU
但是这个繁复做实验，发现，一般情况下是<strong>主控线程</strong>先执行，一般线程后执行。当然，只是科普，不敢这么写代码</p> <h3 id="_6）pthread-cancel函数（杀死线程）"><a href="#_6）pthread-cancel函数（杀死线程）" class="header-anchor">#</a> 6）pthread_cancel函数（杀死线程）</h3> <p>杀死(取消)线程
其作用，对应进程中 kill() 函数。</p> <p>kill是通过通过发信号杀死的，但是线程的这个函数杀死成功率很高。</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>int pthread_cancel(pthread_t thread);	成功：0；失败：错误号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_7）pthread-equal函数（判断进程id相等）"><a href="#_7）pthread-equal函数（判断进程id相等）" class="header-anchor">#</a> 7）pthread_equal函数（判断进程ID相等）</h3> <p>现在的Linux操作系统中，这个函数没神马用，现在ID都是整数，之间数学比较就好了
以前，pthread_t是为了以后可能的扩展，比如现在是int,以后是结构体。</p> <p>比较两个线程ID是否相等。</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>int pthread_equal(pthread_t t1, pthread_t t2);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有可能Linux在未来线程ID pthread_t 类型被修改为结构体实现。</p> <h2 id="控制原语对比"><a href="#控制原语对比" class="header-anchor">#</a> 控制原语对比</h2> <table><thead><tr><th>进程</th> <th>线程</th></tr></thead> <tbody><tr><td>fork</td> <td>pthread_create</td></tr> <tr><td>exit</td> <td>pthread_exit</td></tr> <tr><td>wait</td> <td>pthread_join</td></tr> <tr><td>kill</td> <td>pthread_cancel</td></tr> <tr><td>getpid</td> <td>pthread_self		命名空间</td></tr></tbody></table> <h2 id="四、线程属性"><a href="#四、线程属性" class="header-anchor">#</a> 四、线程属性</h2> <p>一般情况下，实际上我们在做开发的时候，我们线程的默认属性是能够满足我们大多数情况下的需求的。
极个别的时候，线程的默认属性不满足，就需要我们自己来设定。</p> <blockquote><ul><li>如我们对程序的性能提出更高的要求那么需要设置线程属性，比如可以通过设置线程<strong>栈的大小</strong>来降低内存的使用，增加最大线程个数。</li></ul></blockquote> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>typedef struct
{
int 					etachstate; 	//线程的分离状态
int 					schedpolicy; 	//线程调度策略
struct sched_param	schedparam; 	//线程的调度参数
int 					inheritsched; 	//线程的继承性
int 					scope; 		//线程的作用域
size_t 				guardsize; 	//线程栈末尾的警戒缓冲区大小
int					stackaddr_set; //线程的栈设置
void* 				stackaddr; 	//线程栈的位置
size_t 				stacksize; 	//线程栈的大小
} pthread_attr_t;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="五、线程库版本（nptl实现机制-posix-，native-posix-thread-library）"><a href="#五、线程库版本（nptl实现机制-posix-，native-posix-thread-library）" class="header-anchor">#</a> 五、线程库版本（NPTL实现机制(POSIX)，Native POSIX Thread Library）</h2> <p>所谓NPTL就是你需要在使用线程的时候，注意一下使用的线程库的版本是什么。（原因是，我们编写的程序，可能<strong>跨平台开发</strong>）
<strong>（库的版本不一样，可能导致程序运行失败，甚至异常）</strong></p> <p>我们先前用的都是<code>POSIX标准</code>下面所<strong>默认推荐的线程库。</strong></p> <p>我们知道Linux下面，都是GNU组织给我们提供的lib库
你用这个可以查询当前库的版本</p> <p>1.察看当前pthread库版本</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>getconf GNU_LIBPTHREAD_VERSION
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>比如我的阿里云服务器</p> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>[略 ~]# getconf GNU_LIBPTHREAD_VERSION
NPTL 2.28
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2.<strong>NPTL实现机制(POSIX)，Native POSIX Thread Library</strong>
3.使用线程库时gcc指定 –lpthread</p> <p>线程使用注意事项
1.主线程退出其他线程不退出，主线程应调用pthread_exit
2.避免僵尸线程
pthread_join
pthread_detach
pthread_create指定分离属性
被join线程可能在join函数返回前就释放完自己的所有内存资源，所以不应当返回被回收线程栈中的值;
3.<strong>malloc和mmap申请的内存可以被其他线程释放</strong>
4.应避免在多线程模型中调用fork除非，马上exec，子进程中只有调用fork的线程存在，其他线程在子进程中均pthread_exit
5.<strong>信号的复杂语义很难和多线程共存，应避免在多线程引入信号机制</strong></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.7ced881c.js" defer></script><script src="/assets/js/54.17f28cb1.js" defer></script>
  </body>
</html>
