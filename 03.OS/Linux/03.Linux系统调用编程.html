<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux系统调用编程代码 | HACV</title>
    <meta name="description" content="Personal Blog Website">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.8eb0d87d.css" as="style"><link rel="preload" href="/assets/js/app.833d99a2.js" as="script"><link rel="preload" href="/assets/js/47.f6eddf0e.js" as="script"><link rel="prefetch" href="/assets/js/10.8bbeb718.js"><link rel="prefetch" href="/assets/js/100.c96aff95.js"><link rel="prefetch" href="/assets/js/101.bc9e10c9.js"><link rel="prefetch" href="/assets/js/102.3636c93e.js"><link rel="prefetch" href="/assets/js/103.ebb552c8.js"><link rel="prefetch" href="/assets/js/104.de6df6ef.js"><link rel="prefetch" href="/assets/js/105.f2d683b1.js"><link rel="prefetch" href="/assets/js/106.8eb3db39.js"><link rel="prefetch" href="/assets/js/107.49dc49da.js"><link rel="prefetch" href="/assets/js/108.d63b4160.js"><link rel="prefetch" href="/assets/js/109.ec96371d.js"><link rel="prefetch" href="/assets/js/11.8434f00b.js"><link rel="prefetch" href="/assets/js/110.8941c479.js"><link rel="prefetch" href="/assets/js/111.cb3ece3c.js"><link rel="prefetch" href="/assets/js/112.13ea0445.js"><link rel="prefetch" href="/assets/js/113.653e72c4.js"><link rel="prefetch" href="/assets/js/114.7957bb00.js"><link rel="prefetch" href="/assets/js/115.67b56752.js"><link rel="prefetch" href="/assets/js/116.f347da22.js"><link rel="prefetch" href="/assets/js/117.f7dd83cf.js"><link rel="prefetch" href="/assets/js/118.6e542651.js"><link rel="prefetch" href="/assets/js/119.83b137bb.js"><link rel="prefetch" href="/assets/js/12.5da1473f.js"><link rel="prefetch" href="/assets/js/120.1d2235c1.js"><link rel="prefetch" href="/assets/js/121.30ad36ce.js"><link rel="prefetch" href="/assets/js/122.0d5e845e.js"><link rel="prefetch" href="/assets/js/123.bc5c8b91.js"><link rel="prefetch" href="/assets/js/124.8fe80f17.js"><link rel="prefetch" href="/assets/js/125.177547d3.js"><link rel="prefetch" href="/assets/js/126.0d26664c.js"><link rel="prefetch" href="/assets/js/127.ac63436b.js"><link rel="prefetch" href="/assets/js/128.758bbb8c.js"><link rel="prefetch" href="/assets/js/129.aa536383.js"><link rel="prefetch" href="/assets/js/13.4e8d9568.js"><link rel="prefetch" href="/assets/js/130.45261cae.js"><link rel="prefetch" href="/assets/js/131.6c269aae.js"><link rel="prefetch" href="/assets/js/132.6aa2c148.js"><link rel="prefetch" href="/assets/js/133.0f61bf1e.js"><link rel="prefetch" href="/assets/js/134.225f769d.js"><link rel="prefetch" href="/assets/js/135.cda9d974.js"><link rel="prefetch" href="/assets/js/136.a5c7478d.js"><link rel="prefetch" href="/assets/js/137.53a1bc76.js"><link rel="prefetch" href="/assets/js/138.b15c5bdf.js"><link rel="prefetch" href="/assets/js/139.48c77f45.js"><link rel="prefetch" href="/assets/js/14.5c804713.js"><link rel="prefetch" href="/assets/js/140.30fa3045.js"><link rel="prefetch" href="/assets/js/141.4410abef.js"><link rel="prefetch" href="/assets/js/142.7818a70d.js"><link rel="prefetch" href="/assets/js/15.b99cc7bb.js"><link rel="prefetch" href="/assets/js/16.14bb49db.js"><link rel="prefetch" href="/assets/js/17.56dc8f9c.js"><link rel="prefetch" href="/assets/js/18.a77292a3.js"><link rel="prefetch" href="/assets/js/19.9b6fd380.js"><link rel="prefetch" href="/assets/js/2.858e80da.js"><link rel="prefetch" href="/assets/js/20.e68649db.js"><link rel="prefetch" href="/assets/js/21.42f4975a.js"><link rel="prefetch" href="/assets/js/22.b2ca9267.js"><link rel="prefetch" href="/assets/js/23.29a0b3be.js"><link rel="prefetch" href="/assets/js/24.a2448943.js"><link rel="prefetch" href="/assets/js/25.bab1e6b7.js"><link rel="prefetch" href="/assets/js/26.e0dbf256.js"><link rel="prefetch" href="/assets/js/27.c84e7b59.js"><link rel="prefetch" href="/assets/js/28.a5e62944.js"><link rel="prefetch" href="/assets/js/29.8fab9bae.js"><link rel="prefetch" href="/assets/js/3.53ecd128.js"><link rel="prefetch" href="/assets/js/30.9cabdfb5.js"><link rel="prefetch" href="/assets/js/31.567375f8.js"><link rel="prefetch" href="/assets/js/32.86c03e8d.js"><link rel="prefetch" href="/assets/js/33.99a402f3.js"><link rel="prefetch" href="/assets/js/34.bfaafdc7.js"><link rel="prefetch" href="/assets/js/35.df702a97.js"><link rel="prefetch" href="/assets/js/36.4d9f9e12.js"><link rel="prefetch" href="/assets/js/37.44a4c6c9.js"><link rel="prefetch" href="/assets/js/38.54e332c6.js"><link rel="prefetch" href="/assets/js/39.8c308bfb.js"><link rel="prefetch" href="/assets/js/4.ba718c7b.js"><link rel="prefetch" href="/assets/js/40.599d05dd.js"><link rel="prefetch" href="/assets/js/41.28433145.js"><link rel="prefetch" href="/assets/js/42.5d04301a.js"><link rel="prefetch" href="/assets/js/43.e53cb35e.js"><link rel="prefetch" href="/assets/js/44.1cc62348.js"><link rel="prefetch" href="/assets/js/45.c25aa3ac.js"><link rel="prefetch" href="/assets/js/46.50b5d0ad.js"><link rel="prefetch" href="/assets/js/48.f2db703b.js"><link rel="prefetch" href="/assets/js/49.89a03e73.js"><link rel="prefetch" href="/assets/js/5.4ebbb385.js"><link rel="prefetch" href="/assets/js/50.dd08f8f1.js"><link rel="prefetch" href="/assets/js/51.a284f4e2.js"><link rel="prefetch" href="/assets/js/52.e4dc124b.js"><link rel="prefetch" href="/assets/js/53.e9dc7521.js"><link rel="prefetch" href="/assets/js/54.1e33bf1b.js"><link rel="prefetch" href="/assets/js/55.4d9814d3.js"><link rel="prefetch" href="/assets/js/56.9436caf7.js"><link rel="prefetch" href="/assets/js/57.aaf38919.js"><link rel="prefetch" href="/assets/js/58.800fcd7b.js"><link rel="prefetch" href="/assets/js/59.5c9ae199.js"><link rel="prefetch" href="/assets/js/6.0bff5906.js"><link rel="prefetch" href="/assets/js/60.244e06d7.js"><link rel="prefetch" href="/assets/js/61.4989f930.js"><link rel="prefetch" href="/assets/js/62.0467583d.js"><link rel="prefetch" href="/assets/js/63.aea99875.js"><link rel="prefetch" href="/assets/js/64.1c08761a.js"><link rel="prefetch" href="/assets/js/65.93b72363.js"><link rel="prefetch" href="/assets/js/66.e6b26353.js"><link rel="prefetch" href="/assets/js/67.d6ca691a.js"><link rel="prefetch" href="/assets/js/68.dfe97b09.js"><link rel="prefetch" href="/assets/js/69.1638a457.js"><link rel="prefetch" href="/assets/js/7.69828a2c.js"><link rel="prefetch" href="/assets/js/70.c767d155.js"><link rel="prefetch" href="/assets/js/71.615ce242.js"><link rel="prefetch" href="/assets/js/72.28e9c562.js"><link rel="prefetch" href="/assets/js/73.6714f2f2.js"><link rel="prefetch" href="/assets/js/74.5b4694bc.js"><link rel="prefetch" href="/assets/js/75.5df43a08.js"><link rel="prefetch" href="/assets/js/76.c576835d.js"><link rel="prefetch" href="/assets/js/77.bad13a20.js"><link rel="prefetch" href="/assets/js/78.be78e4c1.js"><link rel="prefetch" href="/assets/js/79.fc581b35.js"><link rel="prefetch" href="/assets/js/8.f1e98a93.js"><link rel="prefetch" href="/assets/js/80.6051d6c1.js"><link rel="prefetch" href="/assets/js/81.f768e4c3.js"><link rel="prefetch" href="/assets/js/82.3c79a2af.js"><link rel="prefetch" href="/assets/js/83.9f1fae4b.js"><link rel="prefetch" href="/assets/js/84.f2ca23eb.js"><link rel="prefetch" href="/assets/js/85.4ecddbfe.js"><link rel="prefetch" href="/assets/js/86.fe27d4ca.js"><link rel="prefetch" href="/assets/js/87.bfe5f911.js"><link rel="prefetch" href="/assets/js/88.6838f2aa.js"><link rel="prefetch" href="/assets/js/89.1b1738a3.js"><link rel="prefetch" href="/assets/js/9.76534e6a.js"><link rel="prefetch" href="/assets/js/90.51c2f6f2.js"><link rel="prefetch" href="/assets/js/91.f9257029.js"><link rel="prefetch" href="/assets/js/92.8e985572.js"><link rel="prefetch" href="/assets/js/93.fd9668e1.js"><link rel="prefetch" href="/assets/js/94.e8e70151.js"><link rel="prefetch" href="/assets/js/95.b6e2779f.js"><link rel="prefetch" href="/assets/js/96.221d4a5e.js"><link rel="prefetch" href="/assets/js/97.a9f955f5.js"><link rel="prefetch" href="/assets/js/98.ea1881e7.js"><link rel="prefetch" href="/assets/js/99.27d22932.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8eb0d87d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HACV</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/02.DataStructureAndAlgorithm/" class="nav-link">🐾数据结构和算法</a></div><div class="nav-item"><a href="/03.OS/" class="nav-link router-link-active">💻操作系统</a></div><div class="nav-item"><a href="/04.Net/" class="nav-link">☁️网络</a></div><div class="nav-item"><a href="/05.SE/" class="nav-link">☕️软件工程</a></div><div class="nav-item"><a href="/06.SQL/" class="nav-link">💾数据库</a></div><div class="nav-item"><a href="/07.InternalSkill/" class="nav-link">🐉计算机内功</a></div><div class="nav-item"><a href="/08.Tools/" class="nav-link">🔧Tools</a></div><div class="nav-item"><a href="/09.Language/" class="nav-link">⚛️C/C++</a></div><div class="nav-item"><a href="https://github.com/HACV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/02.DataStructureAndAlgorithm/" class="nav-link">🐾数据结构和算法</a></div><div class="nav-item"><a href="/03.OS/" class="nav-link router-link-active">💻操作系统</a></div><div class="nav-item"><a href="/04.Net/" class="nav-link">☁️网络</a></div><div class="nav-item"><a href="/05.SE/" class="nav-link">☕️软件工程</a></div><div class="nav-item"><a href="/06.SQL/" class="nav-link">💾数据库</a></div><div class="nav-item"><a href="/07.InternalSkill/" class="nav-link">🐉计算机内功</a></div><div class="nav-item"><a href="/08.Tools/" class="nav-link">🔧Tools</a></div><div class="nav-item"><a href="/09.Language/" class="nav-link">⚛️C/C++</a></div><div class="nav-item"><a href="https://github.com/HACV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Linux系统调用编程代码</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#一、进程" class="sidebar-link">一、进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_1、环境变量" class="sidebar-link">1、环境变量</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_2、fork出的满二叉树" class="sidebar-link">2、fork出的满二叉树</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_3、fork父子详解" class="sidebar-link">3、fork父子详解</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_4、wait和waitpid回收子进程" class="sidebar-link">4、wait和waitpid回收子进程</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_5、exec函数族" class="sidebar-link">5、exec函数族</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_6、dup和dup2的使用" class="sidebar-link">6、dup和dup2的使用</a></li></ul></li><li><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#二、进程间通信（ipc）" class="sidebar-link">二、进程间通信（IPC）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_0、文件完成ipc（最易）" class="sidebar-link">0、文件完成IPC（最易）</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_1、管道" class="sidebar-link">1、管道</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_2、共享『存储』映射" class="sidebar-link">2、共享『存储』映射</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#信号量" class="sidebar-link">信号量</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#消息队列" class="sidebar-link">消息队列</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_3、套接字" class="sidebar-link">3、套接字</a></li><li class="sidebar-sub-header"><a href="/03.OS/Linux/03.Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%BC%96%E7%A8%8B.html#_4、信号（signal）" class="sidebar-link">4、信号（Signal）</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="linux系统调用编程代码"><a href="#linux系统调用编程代码" class="header-anchor">#</a> Linux系统调用编程代码</h1> <h2 id="一、进程"><a href="#一、进程" class="header-anchor">#</a> 一、进程</h2> <h3 id="_1、环境变量"><a href="#_1、环境变量" class="header-anchor">#</a> 1、环境变量</h3> <ul><li>获取当前『进程』的所有环境变量</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//environ.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token comment">//二级指针</span>
<span class="token keyword">extern</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>environ<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> environ<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> environ<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//测试2，加下列语句</span>
        <span class="token comment">//break;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_2、fork出的满二叉树"><a href="#_2、fork出的满二叉树" class="header-anchor">#</a> 2、fork出的满二叉树</h3> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> var <span class="token operator">=</span> <span class="token number">34</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    pid_t pid<span class="token punctuation">;</span>

    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token comment">//获得子进程id之后，我睡一会</span>
        <span class="token comment">//睡觉的原因：fork之后，父进程还是子进程先执行不确定，取决于『内核』所使用的调度算法</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        var <span class="token operator">=</span> <span class="token number">55</span><span class="token punctuation">;</span>
       	<span class="token comment">//如果在shell中运行，主要的进程的父进程，就是bash</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I'm parent pid = %d, parentID = %d, var = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token comment">//子进程，本身被创建处理之后，向上溯源</span>
        var <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child  pid = %d, parentID=%d, var = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;var = %d\n&quot;</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="_3、fork父子详解"><a href="#_3、fork父子详解" class="header-anchor">#</a> 3、fork父子详解</h3> <ul><li>父子进程相同：</li></ul> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>1、全局变量『原因见到3』
2、.text	//那是自然，fork出的，代码执行逻辑自然没变，自然.text相同——————但是，fork出来的『子进程执行』位置不同
3、.data	//数据段，自然也是，这个里面毕竟放的『已经初始化好的全局变量，静态变量
4、栈
5、堆
6、环境变量
7、用户ID	//比如是root执行
8、宿主目录
9、进程工作目录
10、信号处理方式
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>父子共享的：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token number">1</span>、文件描述符（打开文件的结构体）	<span class="token comment">//很自然的，这样IPC不就可以了？？</span>
<span class="token number">2</span>、mmap建立的映射区（进程间通信
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>父子不同</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token number">1</span>、进程ID	『毕竟，都突然变成<span class="token number">2</span>个进程了
<span class="token number">2</span>、父进程ID	『毕竟，每个进程的父亲是唯一的，谁fork出来的，还是要不忘本
<span class="token number">3</span>、fork返回值	『父进程调用fork获得子进程的ID，转而，子进程出生的那一刻，从这个函数那个地方执行开始新的故事，这个时候，fork一切从<span class="token number">0</span>开始
    
PS：上述<span class="token number">3</span>个概念，见『fork出的满二叉树』这一节的代码测试
<span class="token number">4</span>、进程运行时间	『毕竟子进程才出生多久
<span class="token number">5</span>、闹钟（定时器）	『毕竟，这个进程是要被调度的，需要定时器
<span class="token number">6</span>、未决信号集
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_4、wait和waitpid回收子进程"><a href="#_4、wait和waitpid回收子进程" class="header-anchor">#</a> 4、wait和waitpid回收子进程</h3> <h4 id="（1）wait"><a href="#（1）wait" class="header-anchor">#</a> （1）wait</h4> <ul><li>回收任意子进程</li> <li>『回收时候的调用方式，是真的很新颖！！</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	pid_t pid<span class="token punctuation">,</span> wpid<span class="token punctuation">;</span>
	pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>		<span class="token comment">//son</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I'm process child, pid = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//困了...</span>
	<span class="token punctuation">}</span> 
	<span class="token keyword">else</span> 
	<span class="token punctuation">{</span>
	lable<span class="token operator">:</span>
		wpid <span class="token operator">=</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//死等!!!,,,,,回收任意子进程</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>wpid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;wait error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">goto</span> lable<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I'm parent, I catched child process,&quot;</span>
				<span class="token string">&quot;pid = %d\n&quot;</span><span class="token punctuation">,</span> wpid<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="（2）waitpid"><a href="#（2）waitpid" class="header-anchor">#</a> （2）waitpid</h4> <ul><li>回收指定的子进程</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	pid_t pid<span class="token punctuation">,</span> pid2<span class="token punctuation">,</span> wpid<span class="token punctuation">;</span>
	<span class="token keyword">int</span> flg <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pid2 <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>		<span class="token comment">//son</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I'm process child, pid = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>					<span class="token comment">//parent</span>
		<span class="token keyword">do</span> <span class="token punctuation">{</span>
			wpid <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> WNOHANG<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//wpid = wait(NULL);</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;---wpid = %d--------%d\n&quot;</span><span class="token punctuation">,</span> wpid<span class="token punctuation">,</span> flg<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>wpid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;NO child exited\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>wpid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//子进程不可回收</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>wpid <span class="token operator">==</span> pid<span class="token punctuation">)</span><span class="token punctuation">{</span>		<span class="token comment">//回收了指定子进程</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I'm parent, I catched child process,&quot;</span>
					<span class="token string">&quot;pid = %d\n&quot;</span><span class="token punctuation">,</span> wpid<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;other...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_5、exec函数族"><a href="#_5、exec函数族" class="header-anchor">#</a> 5、exec函数族</h3> <ul><li>毕竟fork出来的，没有做其他完全不相关逻辑的程序，所以用exec函数族</li> <li>这一族函数，由于最终所有的函数底层都调用了『execve』函数，所以只有它才是『系统调用』，其他函数只是在这个上面包装的假的系统调用</li></ul> <h3 id="_6、dup和dup2的使用"><a href="#_6、dup和dup2的使用" class="header-anchor">#</a> 6、dup和dup2的使用</h3> <ul><li>文件描述符的复制，有地方称之为：重定向文件描述符</li> <li>『其实，复制这个叫法比重定向这个叫法更加确切一点』</li> <li>上面2个函数都能实现这个效果</li></ul> <h2 id="二、进程间通信（ipc）"><a href="#二、进程间通信（ipc）" class="header-anchor">#</a> 二、进程间通信（IPC）</h2> <blockquote><p>IPC，InterProcess Communication</p></blockquote> <h3 id="_0、文件完成ipc（最易）"><a href="#_0、文件完成ipc（最易）" class="header-anchor">#</a> 0、文件完成IPC（最易）</h3> <ul><li>使用文件就能完成IPC（<strong>很显然</strong>）</li> <li>fork之后，父子进程，共享文件描述符，也就共享打开的文件</li> <li>由于，可以通过的文件，一般是在磁盘上，所以，笔者，都想给他取个名字『<strong>共享外存</strong>』2333</li></ul> <h3 id="_1、管道"><a href="#_1、管道" class="header-anchor">#</a> 1、管道</h3> <h4 id="（1）pipe（无名-匿名管道）"><a href="#（1）pipe（无名-匿名管道）" class="header-anchor">#</a> （1）pipe（无名/匿名管道）</h4> <ul><li>最基本的1种IPC机制</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token number">1</span>、『有血缘关系，进程，完成数据传输
<span class="token number">2</span>、本质是<span class="token number">1</span>个伪文件，实为（内核缓冲区）
<span class="token number">3</span>、
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="（2）fifo（命名管道）"><a href="#（2）fifo（命名管道）" class="header-anchor">#</a> （2）fifo（命名管道）</h4> <ul><li>只能用于『有血缘关系』的进程间</li></ul> <h3 id="_2、共享『存储』映射"><a href="#_2、共享『存储』映射" class="header-anchor">#</a> 2、共享『存储』映射</h3> <ul><li>我们一般叫『共享内存』，但是笔者根据下面所说，我觉得，存储应该包括下面</li></ul> <blockquote><p>所谓存储：</p> <p>1、内存</p> <p>2、外存，比如，U盘，硬盘</p></blockquote> <h4 id="（1）共享文件描述符（最易）"><a href="#（1）共享文件描述符（最易）" class="header-anchor">#</a> （1）共享文件描述符（最易）</h4> <ul><li>比如fork</li></ul> <h4 id="（2）共享内存"><a href="#（2）共享内存" class="header-anchor">#</a> （2）共享内存</h4> <ul><li>存储映射I/O『Memory-mapped I/O』，或许mmap函数是由于这个来的</li> <li>原理：</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token number">1</span>、存储映射I<span class="token operator">/</span>O使<span class="token number">1</span>个“磁盘文件”与“存储空间”中的<span class="token number">1</span>个缓冲区相映射。这样，我们就可以在不使用read和write的情况下，使用地址（指针）完成I<span class="token operator">/</span>O操作『『把外存中的东西，映射到内存中之后再操作』』
<span class="token number">2</span>、所以：首先，我们需要通知内核，将<span class="token number">1</span>个指定的文件映射到存储区域中。这个映射可以通过mmap函数来实现
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>从原理容易知道：『在有血缘和无血缘关系都可以进行通信</li></ul> <h5 id="『1』mmap函数"><a href="#『1』mmap函数" class="header-anchor">#</a> 『1』mmap函数</h5> <ul><li>返回创建的『映射区』首地址</li></ul> <h5 id="『2』munmap函数"><a href="#『2』munmap函数" class="header-anchor">#</a> 『2』munmap函数</h5> <ul><li>与malloc函数申请内存空间类似，mmap建立的映射区在使用结束后也应该调用类似free的函数来释放</li> <li>就是在mmap函数中加上了un</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">smalloc</span><span class="token punctuation">(</span>size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

	p <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> PROT_READ<span class="token operator">|</span>PROT_WRITE<span class="token punctuation">,</span> 
			MAP_SHARED<span class="token operator">|</span>MAP_ANON<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span> <span class="token punctuation">{</span>		
		p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">sfree</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">munmap</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
	pid_t pid<span class="token punctuation">;</span>
	
	p <span class="token operator">=</span> <span class="token function">smalloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//创建子进程</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
		<span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child, *p = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
    <span class="token keyword">else</span> 
    <span class="token punctuation">{</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent, *p = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">sfree</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="信号量"><a href="#信号量" class="header-anchor">#</a> 信号量</h3> <h3 id="消息队列"><a href="#消息队列" class="header-anchor">#</a> 消息队列</h3> <h3 id="_3、套接字"><a href="#_3、套接字" class="header-anchor">#</a> 3、套接字</h3> <ul><li>『最稳定』的方式</li> <li>比如，我们的『网络程序，就是2个或多个进程之间通信，使用Socket</li></ul> <h3 id="_4、信号（signal）"><a href="#_4、信号（signal）" class="header-anchor">#</a> 4、信号（Signal）</h3></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.833d99a2.js" defer></script><script src="/assets/js/47.f6eddf0e.js" defer></script>
  </body>
</html>
